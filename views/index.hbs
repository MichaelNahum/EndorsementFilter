<!DOCTYPE html>
<html>
<!-- <script async defer src="https://apis.google.com/js/api.js"
onload="this.onload=function(){};handleClientLoad()"
onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>
<script  src="../client_secret.json"></script>
<script src="../quickstart.js"></script> -->
  <head>
    <title>Goes Back</title>
    <meta charset='utf-8' />
    <link rel="stylesheet" type="text/css" href="style.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
    <h2>Endorsement Validator</h2>
   <p>{{message}}</p>
    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize-button" style="display: none;">Authorize</button>
    <button id="signout-button" style="display: none;">Sign Out</button>

    <pre id="content"></pre>

  <div id="column">
   <div class="topnav">
     <input type="text" placeholder="Location..." id="place">
     <input type="text" placeholder="Hours back..." id="time">
   </div>
   <div id="endorsements">
   </div>
   <div class="endorsement">
     <span class="timestamp">08:04pm May 12, 2018 EDT</span>
     <div class="headline">Syrian government forces fire on coalition aircraft near SDF controlled village of Mahkan, Syria: Local News Outlet via Twitter.</div><br>
   </div>
 </div>

    <script>

    messages = {{{messages}}}

    endorse_template = $('.endorsement').clone();
    $('.endorsement').remove();

    let userSearch = $('#place').val()
    let captions = messages.filter(message => {
      return message.payload.headers[31].value.match(/userSearch/g);
    });
    let names={};
    let dates={};
    for(let i=0; i<captions.length;i++){
      names[i]=captions[i].payload.headers[31].value;
      dates[i]=captions[i].payload.headers[34].value;
    }

    function createEndorsement(email) {
      let endorse = endorse_template.clone();
      endorse.find('.timestamp').text(new Date(+email.internalDate));
      endorse.find('.headline').text(email.payload.headers[31].value);
      return endorse;
    }

    function populateMessages(captions) {
      return captions.map(e => createEndorsement(e));
    }

  //$("#endorsements").append(populateMessages(captions));
   $("#place").submit(function() {
     $("#endorsements").append(populateMessages(captions))
   });



    </script>

  </body>
</html>
